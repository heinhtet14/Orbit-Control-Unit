/*
 * DC.c
 *
 *  Created on: Apr 22, 2022
 *      Author: HEIN.H
 */
#include "DC.h"

static float IMPULSE_RESPONSE[DISCRETE_CONV] ={0.00413124454145211,
		0.00490754667245379,
		0.00519993039908241,
		0.00496262459646758,
		0.00420331931899222,
		0.00298403973545525,
		0.0014164192204121,
		-0.000348309854390278,
		-0.00213373297492349,
		-0.00375572116355732,
		-0.00504123641305644,
		-0.00584657196022117,
		-0.0060731255017646,
		-0.0056790008205544,
		-0.00468511239721878,
		-0.00317499467228177,
		-0.00128814272065817,
		0.000792627308120753,
		0.00285867858980699,
		0.00469626082388756,
		0.00610838977281144,
		0.00693568216276701,
		0.00707396894180487,
		0.00648677483366363,
		0.00521122149044485,
		0.00335654322064861,
		0.00109513826690478,
		-0.00135315729336379,
		-0.00374216917176574,
		-0.00582385955079719,
		-0.00737377045191241,
		-0.00821485556711118,
		-0.00823720535024407,
		-0.00741151315157467,
		-0.00579470386304711,
		-0.00352689929486077,
		-0.000819754896802577,
		0.0020629140624912,
		0.00483048155121791,
		0.00719443420709206,
		0.00889802684560684,
		0.00974366225376251,
		0.00961512330154743,
		0.00849221804466451,
		0.00645609318172724,
		0.00368436554367565,
		0.000436230654852116,
		-0.00297126701726488,
		-0.00619367922691888,
		-0.00889343852273389,
		-0.0107746204536338,
		-0.0116146609111623,
		-0.0112896971049645,
		-0.00979073538283633,
		-0.00722868462864834,
		-0.00382735571661887,
		9.52842596968824E-05,
		0.00415611516068716,
		0.00794354700145489,
		0.011058439085069,
		0.0131552616529373,
		0.0139793405242174,
		0.0133962718554912,
		0.0114102428096238,
		0.00816899326686488,
		0.00395441571958287,
		-0.000840801973782799,
		-0.00574866877663586,
		-0.0102704089565777,
		-0.0139258756176257,
		-0.0163030803601804,
		-0.0171028650576427,
		-0.0161740347492728,
		-0.0135350402353653,
		-0.00937948616139966,
		-0.0040642430366588,
		0.00191937698966397,
		0.00798921973470406,
		0.0135269489644303,
		0.0179388025147942,
		0.0207166698023862,
		0.0214934399498528,
		0.0200868753746606,
		0.0165271453382802,
		0.0110645441341739,
		0.00415570421890545,
		-0.00357136165343623,
		-0.0113709791770336,
		-0.0184479511290105,
		-0.0240341798530971,
		-0.0274667437424921,
		-0.02825992893283,
		-0.026163942124099,
		-0.0212039544585752,
		-0.0136946896710519,
		-0.00422785016955064,
		0.00636790243721086,
		0.0170921432208272,
		0.0268583365823008,
		0.0345931078680897,
		0.0393407174602715,
		0.0403634458970314,
		0.0372285324323451,
		0.0298730866511012,
		0.0186399722574252,
		0.00427992898848629,
		-0.0120820275767979,
		-0.0290148388120641,
		-0.0448801154597088,
		-0.0579543698732215,
		-0.0665655127085874,
		-0.0692327899313776,
		-0.0647986506183186,
		-0.0525413163737268,
		-0.0322580686802346,
		-0.00431139617628367,
		0.0303670136634695,
		0.0703161233159602,
		0.113627375348865,
		0.158063185065657,
		0.201203695969858,
		0.24061096231969,
		0.273998145524235,
		0.299390734580962,
		0.315267283374055,
		0.320668667742111,
		0.315267283374055,
		0.299390734580962,
		0.273998145524235,
		0.24061096231969,
		0.201203695969858,
		0.158063185065657,
		0.113627375348865,
		0.0703161233159602,
		0.0303670136634695,
		-0.00431139617628367,
		-0.0322580686802346,
		-0.0525413163737268,
		-0.0647986506183186,
		-0.0692327899313776,
		-0.0665655127085874,
		-0.0579543698732215,
		-0.0448801154597088,
		-0.0290148388120641,
		-0.0120820275767979,
		0.00427992898848629,
		0.0186399722574252,
		0.0298730866511012,
		0.0372285324323451,
		0.0403634458970314,
		0.0393407174602715,
		0.0345931078680897,
		0.0268583365823008,
		0.0170921432208272,
		0.00636790243721086,
		-0.00422785016955064,
		-0.0136946896710519,
		-0.0212039544585752,
		-0.026163942124099,
		-0.02825992893283,
		-0.0274667437424921,
		-0.0240341798530971,
		-0.0184479511290105,
		-0.0113709791770336,
		-0.00357136165343623,
		0.00415570421890545,
		0.0110645441341739,
		0.0165271453382802,
		0.0200868753746606,
		0.0214934399498528,
		0.0207166698023862,
		0.0179388025147942,
		0.0135269489644303,
		0.00798921973470406,
		0.00191937698966397,
		-0.0040642430366588,
		-0.00937948616139966,
		-0.0135350402353653,
		-0.0161740347492728,
		-0.0171028650576427,
		-0.0163030803601804,
		-0.0139258756176257,
		-0.0102704089565777,
		-0.00574866877663586,
		-0.000840801973782799,
		0.00395441571958287,
		0.00816899326686488,
		0.0114102428096238,
		0.0133962718554912,
		0.0139793405242174,
		0.0131552616529373,
		0.011058439085069,
		0.00794354700145489,
		0.00415611516068716,
		9.52842596968824E-05,
		-0.00382735571661887,
		-0.00722868462864834,
		-0.00979073538283633,
		-0.0112896971049645,
		-0.0116146609111623,
		-0.0107746204536338,
		-0.00889343852273389,
		-0.00619367922691888,
		-0.00297126701726488,
		0.000436230654852116,
		0.00368436554367565,
		0.00645609318172724,
		0.00849221804466451,
		0.00961512330154743,
		0.00974366225376251,
		0.00889802684560684,
		0.00719443420709206,
		0.00483048155121791,
		0.0020629140624912,
		-0.000819754896802577,
		-0.00352689929486077,
		-0.00579470386304711,
		-0.00741151315157467,
		-0.00823720535024407,
		-0.00821485556711118,
		-0.00737377045191241,
		-0.00582385955079719,
		-0.00374216917176574,
		-0.00135315729336379,
		0.00109513826690478,
		0.00335654322064861,
		0.00521122149044485,
		0.00648677483366363,
		0.00707396894180487,
		0.00693568216276701,
		0.00610838977281144,
		0.00469626082388756,
		0.00285867858980699,
		0.000792627308120753,
		-0.00128814272065817,
		-0.00317499467228177,
		-0.00468511239721878,
		-0.0056790008205544,
		-0.0060731255017646,
		-0.00584657196022117,
		-0.00504123641305644,
		-0.00375572116355732,
		-0.00213373297492349,
		-0.000348309854390278,
		0.0014164192204121,
		0.00298403973545525,
		0.00420331931899222,
		0.00496262459646758,
		0.00519993039908241,
		0.00490754667245379,
		0.00413124454145211,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0,
		0};

void DC_Init(DC *dc){
	/*Clear Buffer Status*/

	for(int n =0; n < DISCRETE_CONV; n++){
		dc->buf[n] = 0.0f;
	}
	dc->bufIndex = 0;

	/*Clear Output*/
	dc->y_out = 0.0f;
}

float DC_Update(DC *dc, float x_in){

	dc-> buf[dc->bufIndex] = x_in;
	dc-> bufIndex++;

	if(dc->bufIndex == DISCRETE_CONV){
		dc->bufIndex = 0;

	}
	dc -> y_out = 0.0f;
	uint8_t sumIndex = dc->bufIndex;

	for(uint8_t n=0 ; n< DISCRETE_CONV; n++){
		if (sumIndex > 0){
			sumIndex--;

		}else{
			sumIndex = DISCRETE_CONV -1;

			dc->y_out += IMPULSE_RESPONSE[n]* dc->buf[sumIndex];
		}
		return dc->y_out;
	}
}

